# file-allocator


## Описание

Достаточно сложно представить себе программу, которая делала бы что-то полезное и при этом не пользовалась памятью. Её можно выделять по-разному: на стеке, на куче, где-нибудь в виртуальном адресном пространстве, с помощью средств стандартной библиотеки или даже сторонних инструментов. Приятно иметь возможность выбора и было бы грустно её лишиться.

К сожалению, именно это и ждёт вас в этой задаче.

От вас требуется написать страничный аллокатор, который выделяет и освобождает страницы по требованию. Чтобы не было скучно, вам будут мешать следующие обстоятельства:

1. Стековой памяти слишком мало
2. Запрещено использовать `brk` и `sbrk`
3. Запрещено использовать `malloc`, `calloc` и `realloc`
4. Запрещено использовать `mmap` с флагом `MAP_ANONYMOUS`
5. Данные на выделенных страницах должны переживать пересоздание аллокатора

Остаётся лишь одно - отобразить файл в память и использовать его.


## Задание

В файле `falloc.h` вы можете найти структуру `file_allocator_t` и связанные с ней методы `falloc_init`, `falloc_destroy`, `falloc_acquire_page` и `falloc_release_page`.

Предлагается реализация со следующими особенностями:

- Размер страницы равен `PAGE_SIZE`
- При вызове `falloc_acquire_page` выделяется первая свободная страница, а если их нет, то возвращается `NULL`
- При вызове `falloc_release_page` указанная страница освобождается и может быть выделена в последующих вызовах `falloc_acquire_page`
- `file_allocator_t.base_addr` указывает на начало первой страницы, страницы должны располагаться в памяти непрерывно
- `file_allocator_t.page_mask` указывает на маску используемых страниц
- Каждый бит маски отвечает за одну страницу
- Необходимо поддерживать актуальное количество выделенных страниц в `file_allocator_t.curr_page_count`
- Аллокатор может выделить не более, чем `file_allocator_t.allowed_page_count` страниц
- Функция `falloc_init` принимает в качестве аргумента путь к файлу `filepath`, возможно две ситуации:
    - Файл не существует
    - Файл существует и был создан ранее в `falloc_init` с тем же параметром `allowed_page_count`


От вас требуется реализовать функции `falloc_init`, `falloc_destroy`, `falloc_acquire_page` и `falloc_release_page`. Шаблон решения находится в файле `falloc.c`.


## Тесты

Протестировать своё решение можно с помощью публичных тестов, описанных в `tester.c`.


## Дополнительная информация 

- [mmap](https://man7.org/linux/man-pages/man2/mmap.2.html)
- [ftruncate](https://man7.org/linux/man-pages/man3/ftruncate.3p.html)
